*{box-sizing:border-box}
:root{
  --bg:#111; --panel:#1a1a1a; --bar:#222; --fg:#eee;
  --accent:#4caf50; --muted:#9aa;
}
body{margin:0;font-family:-apple-system,system-ui,sans-serif;background:var(--bg);color:var(--fg);}
header{
  position:fixed; top:0; left:0; right:0; z-index:20;
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px; background:var(--bar);
}
.title{font-weight:700}
.topBtns button{padding:8px 12px; margin-left:8px}

footer{
  position:fixed; bottom:0; left:0; right:0; z-index:20;
  padding:10px 12px; background:var(--bar);
  display:flex; gap:10px;
}
footer button{padding:10px 12px}

canvas{
  display:block;
  background:#000;
  touch-action:none;
  position:fixed;
  left:0; right:0;
  top:56px;
  bottom:56px;
  width:100%;
  height:calc(100vh - 112px);
}

.panel{
  position:fixed;
  top:56px; left:0; right:0;
  max-height:calc(100vh - 112px);
  overflow:auto;
  background:var(--panel);
  z-index:30;
  padding:12px;
  border-top:1px solid #2a2a2a;
}
.hidden{display:none}

#palettePanel{display:flex; flex-wrap:wrap; gap:12px; padding-bottom:16px}
.tile{
  width:64px; height:64px;
  border-radius:10px;
  border:2px solid #333;
}
.tile.selected{border-color:var(--accent); box-shadow:0 0 10px var(--accent)}

.panelHeader{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px}
.panelTitle{font-weight:700}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px;margin-bottom:12px}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.hint{color:var(--muted); font-size:13px; line-height:1.35; margin-top:8px}
.hint.small{font-size:12px}
.primary{background:var(--accent); color:#081; border:none; border-radius:10px; padding:10px 12px; font-weight:700}
button{border:1px solid #3a3a3a;background:#2a2a2a;color:var(--fg);border-radius:10px}
button:active{transform:scale(0.99)}

.list{display:flex; flex-direction:column; gap:8px; margin-top:10px}
.item{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px; border:1px solid #2a2a2a; border-radius:12px; background:#101010;
}
.itemLeft{display:flex; align-items:center; gap:10px}
.thumb{
  width:44px; height:44px; border-radius:10px;
  border:1px solid #2a2a2a; background:#0a0a0a; object-fit:contain;
}
.badge{font-size:12px;color:var(--muted)}
.smallBtn{padding:8px 10px}

.backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.55); z-index:40;
}
.modal{
  position:fixed; left:12px; right:12px; top:72px;
  max-height:calc(100vh - 144px);
  overflow:auto;
  background:#0f0f0f; border:1px solid #2a2a2a; border-radius:16px;
  z-index:50;
}
.modalHeader{display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid #222}
.modalTitle{font-weight:800}
.modalBody{padding:12px}
.field{display:flex; flex-direction:column; gap:6px; margin-bottom:12px}
.field span{font-size:12px; color:var(--muted)}
.field input{padding:10px; border-radius:12px; border:1px solid #2a2a2a; background:#111; color:var(--fg)}
.grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}

#hud{position:fixed; inset:0; pointer-events:none; z-index:25;}
#modeBadge{
  position:fixed; top:64px; left:12px;
  background:rgba(0,0,0,.55); border:1px solid #2a2a2a;
  padding:6px 10px; border-radius:999px; font-weight:800;
}
#dpad{
  position:fixed; bottom:74px; left:12px;
  pointer-events:auto;
  display:flex; flex-direction:column; gap:8px;
}
.dpad-btn{
  width:54px; height:54px;
  border-radius:14px;
  background:rgba(30,30,30,.9);
  border:1px solid #3a3a3a;
  font-size:18px;
}
.dpad-mid{display:flex; gap:8px; align-items:center}
