<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RPG DREAM — Offline Editor</title>
  <meta name="theme-color" content="#0b1020"/>
  <style>
    :root{
      --bg:#0b1020;--panel:#111830;--panel-2:#0f162e;--accent:#2d6cff;--accent-2:#6aa2ff;
      --text:#ffffff;--muted:#9aa3c7;--btn:#1a2244;--btn-hover:#24306b;--grid:rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system}
    #app{max-width:1100px;margin:0 auto;padding:12px;display:grid;grid-template-rows:auto auto 1fr;gap:12px}
    header{background:var(--panel);border-radius:16px;padding:12px;display:flex;gap:8px;flex-wrap:wrap}
    .tab{background:var(--btn);color:var(--muted);border:none;padding:10px 16px;border-radius:999px;cursor:pointer}
    .tab.active{background:var(--accent);color:#fff}
    .status{margin-left:auto;font-size:12px;color:var(--muted)}
    main{display:grid;grid-template-columns:280px 1fr;gap:12px;min-height:0}
    .panel{background:var(--panel);border-radius:16px;padding:12px;overflow:auto}
    .panel h3{margin:0 0 8px 0;font-size:14px;color:var(--accent-2)}
    .btn{background:var(--btn);color:#fff;border:none;border-radius:10px;padding:8px 10px;cursor:pointer;margin:4px 4px 0 0}
    .btn.primary{background:var(--accent)}
    .swatches{display:flex;flex-wrap:wrap;gap:6px}
    .swatch{width:28px;height:28px;border-radius:6px;border:2px solid rgba(255,255,255,.2);cursor:pointer}
    .swatch.active{outline:2px solid var(--accent)}
    .editor{background:var(--panel-2);border-radius:16px;padding:12px;display:flex;align-items:center;justify-content:center}
    canvas{background:#0d1430;border-radius:12px;max-width:100%}
    footer{background:var(--panel);border-radius:16px;padding:10px 12px;font-size:12px;color:var(--muted)}
    @media(max-width:900px){main{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div id="app">
  <header>
    <button class="tab active" data-mode="terrain">Terrain</button>
    <button class="tab" data-mode="collision">Collision</button>
    <button class="tab" data-mode="characters">Characters</button>
    <span class="status" id="status">offline • ready</span>
  </header>
  <main>
    <aside class="panel" id="leftPanel"></aside>
    <section class="editor"><canvas id="mapCanvas"></canvas></section>
  </main>
  <footer>RPG DREAM • single-file offline editor</footer>
</div>

<script>
console.log("single-file baseline loaded");

const TILE=32, COLS=20, ROWS=15, KEY="rpgdream_single_v1";
const BIOMES={
  plains:[{id:"grass",c:"#2ecc71"},{id:"dirt",c:"#a0522d"},{id:"stone",c:"#7f8c8d"}],
  desert:[{id:"sand",c:"#e0c068"},{id:"rock",c:"#9c8b6b"}]
};
const state={mode:"terrain",biome:"plains",tile:"grass",map:[]};

const canvas=document.getElementById("mapCanvas");
const ctx=canvas.getContext("2d");
canvas.width=COLS*TILE; canvas.height=ROWS*TILE;

function emptyMap(){return Array.from({length:ROWS},()=>Array.from({length:COLS},()=>null))}
function save(){localStorage.setItem(KEY,JSON.stringify(state))}
function load(){try{Object.assign(state,JSON.parse(localStorage.getItem(KEY)||"{}"))}catch(e){}}
load(); if(!state.map||!state.map.length) state.map=emptyMap();

function panelTerrain(){
  const p=document.getElementById("leftPanel"); p.innerHTML="<h3>Biome</h3>";
  Object.keys(BIOMES).forEach(b=>{
    const btn=document.createElement("button"); btn.className="btn"+(state.biome===b?" primary":"");
    btn.textContent=b; btn.onclick=()=>{state.biome=b; panelTerrain()}; p.appendChild(btn);
  });
  p.innerHTML+="<h3>Tiles</h3><div class='swatches' id='sw'></div>";
  const sw=document.getElementById("sw");
  BIOMES[state.biome].forEach(t=>{
    const s=document.createElement("div"); s.className="swatch"+(state.tile===t.id?" active":"");
    s.style.background=t.c; s.onclick=()=>{state.tile=t.id; panelTerrain()}; sw.appendChild(s);
  });
}
function panelCollision(){document.getElementById("leftPanel").innerHTML="<h3>Collision</h3>"}
function panelCharacters(){document.getElementById("leftPanel").innerHTML="<h3>Characters</h3>"}

function renderPanel(){ if(state.mode==="terrain") panelTerrain();
  if(state.mode==="collision") panelCollision();
  if(state.mode==="characters") panelCharacters(); }

document.querySelectorAll(".tab").forEach(b=>b.onclick=()=>{
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
  b.classList.add("active"); state.mode=b.dataset.mode; renderPanel();
});

function colorBy(id){for(const k in BIOMES){const f=BIOMES[k].find(x=>x.id===id); if(f) return f.c}}
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){
    const t=state.map[y][x]; if(t){ctx.fillStyle=colorBy(t); ctx.fillRect(x*TILE,y*TILE,TILE,TILE)}
    ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--grid');
    ctx.strokeRect(x*TILE,y*TILE,TILE,TILE);
  }
}
canvas.addEventListener("pointerdown",e=>{
  if(state.mode!=="terrain") return;
  const r=canvas.getBoundingClientRect();
  const x=Math.floor((e.clientX-r.left)/TILE), y=Math.floor((e.clientY-r.top)/TILE);
  if(x<0||y<0||x>=COLS||y>=ROWS) return;
  state.map[y][x]=state.tile; save(); draw();
});

renderPanel(); draw(); document.getElementById("status").textContent="offline • loaded";
</script>
</body>
</html>
